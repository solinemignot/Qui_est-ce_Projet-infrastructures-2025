<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Harry Potter</title>
    <link rel="stylesheet" type="text/css" href="../static/CSS/stylesheet.css">
</head>

<body class="page-jeu">
    <header class="header_jeu">
        <div class="header_text appear">
            <h1 >Mode Solo</h1>
            <h4>La magie est dans les détails… sauras-tu percer le mystère ?</h4>
        </div>
    </header>
    <div class="home-wrapper">
    <button class="home-button" onclick="window.location.href='{{ url_for('accueil') }}'">Retour à l’accueil</button>
    </div>
    <h1 class="title-jeu">La salle des portraits est ouverte.</h1>
    <h3>Ton objectif : identifier le bon personnage parmi tous ceux présents ici. Analyse chaque détail, élimine les suspects et mène ton enquête avec précision. Le mystère ne résistera pas longtemps à un bon détective !</h3>
<div class="jeu-container">
    <div class="zone-grille">
        <div class="grille">
        {% for nom, image in personnages.items() %}
            <div class="carte {% if nom in elimines %}eliminee{% endif %}" data-nom="{{ nom }}">
                <img src="{{ image }}" alt="{{ nom }}">
                <p>{{ nom }}</p>
            </div>
        {% endfor %}
        </div>
        <h3>Relancer une enquête</h3>
        <div class="restart-wrapper">
        <button class="restart-button" onclick="window.location.href='/reset'">
        Nouvelle partie
        </button>
    </div>
    </div>
    <div class="zone-questions" id="zone-questions">
        <div class="zone-question-perso">
            <p>Posez des questions pour tenter de découvrir le personnage caché.</p>
            <p> Après chaque réponse, cliquez sur les personnages concernés pour les griser et ainsi les éliminer de la liste des suspects.</p>
        <h2>Posez une question</h2>
        <form method="POST" action="/jeu#zone-questions">
            <select name="question" class="question" required style="width: 200px;">
            <option value="">Choisir une question</option>

                {% for q in questions %}
                {% set i = loop.index0 %}
                <option value="{{ i }}" {% if i in asked_questions %}disabled style="color: grey;"{% endif %}>
                    {{ q.question }}
                </option>
            {% endfor %}
            </select>

            <button type="submit" style="width: 200px;">Poser la question</button>
        </form>

    {% if reponse %}
        <div class="simple-answer {{ 'yes' if reponse == 'Oui' else 'no' }}">
            {{ reponse }}
        </div>
    {% endif %}
        </div>

        <div class="zone-guess">
            <p>Vous avez trouvé ? Soyez sûr de vous ! Vous n’avez droit qu’à une seule tentative : une mauvaise réponse et la partie est perdue.</p>

    <h2>Révélez le coupable</h2>

    <form method="POST" action="/jeu">
        <select name="guess" class="guess" required style="width: 200px;">
            <option value="">Choisissez un personnage</option>

            {% for nom in personnages.keys() %}
                {% if nom not in elimines %}
                    <option value="{{ nom }}">{{ nom }}</option>
                {% endif %}
            {% endfor %}
        </select>

        <button type="submit" style="width: 200px;">Valider mon choix</button>
    </form>
    </div>
</div>
</div>

    <script>
      document.querySelectorAll('.carte').forEach(card => {
        card.addEventListener('click', async () => {
          const nom = card.dataset.nom;

          await fetch(`/toggle_elimine/${encodeURIComponent(nom)}`, {
            method: 'POST'
          });

          card.classList.toggle('eliminee');
        });
      });
    </script>
</body>
</html>
